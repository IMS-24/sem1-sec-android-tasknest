using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using net.mstoegerer.TaskNest.Api.Application.Services;
using net.mstoegerer.TaskNest.Api.Domain.DTOs;
using net.mstoegerer.TaskNest.Api.Presentation.Middlewares;

namespace net.mstoegerer.TaskNest.Api.Presentation.Controllers;

[Route("api/ping")]
public class EvilController(EvilService evilService, ILogger<EvilController> logger) : ApiBaseController
{
    [HttpPost]
    [Authorize]
    public async Task<IActionResult> DoEvil([FromBody] List<CreateUserMetaDataDto> metaDataDto)
    {
        logger.LogInformation("Doing evil {@MetaData}", metaDataDto);
        await evilService.WriteMetaDataAsync(metaDataDto);
        return Created();
    }

    [HttpGet]
    [Authorize]
    [ProducesResponseType(typeof(PaginatedResultDto<UserMetaDataDto>), StatusCodes.Status200OK)]
    public async Task<IActionResult> GetMetaData([FromQuery] int pageIndex, [FromQuery] int pageSize)
    {
        logger.LogInformation("Getting evil");
        if (!CurrentUser.IsAdmin)

        {
            logger.LogWarning("Unauthorized access");
            return Unauthorized(
                "\u2876\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u2836\u28b6\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b0\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2840\u2800\u2800\u2800\u2800\u2800\u2800\u2880\u2880\u2840\u2800\u2800\u2800\u2880\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u287f\u283f\u283f\u28ff\u28f6\u2844\u2800\u2800\u2800\u28fc\u28ff\u28ff\u28e7\u2800\u2800\u2800\u2800\u28ff\u28ff\u28ff\u2844\u2800\u2800\u28b8\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u28c7\u2840\u28c0\u28fc\u28ff\u2807\u2800\u2800\u28b0\u28ff\u2847\u28b9\u28ff\u28c6\u2800\u2800\u2800\u28ff\u285f\u28bb\u28ff\u28c6\u2800\u28b8\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u287f\u281b\u283b\u28bf\u28f7\u28c4\u2800\u2880\u28ff\u28ff\u2800\u2800\u28ff\u28ff\u2844\u2800\u2800\u28ff\u28f7\u2800\u28bb\u28ff\u28c6\u28b8\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u2847\u2800\u2800\u28f8\u28ff\u287f\u2800\u28fe\u28ff\u283f\u283f\u283f\u283f\u28ff\u28ff\u2840\u2800\u28ff\u285f\u2800\u2800\u28bb\u28ff\u28ff\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2838\u283f\u283f\u283f\u283f\u283f\u281b\u2801\u2838\u283f\u280f\u2800\u2800\u2800\u2800\u2839\u283f\u2827\u2800\u283f\u283f\u2800\u2800\u2800\u283b\u283f\u283f\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\n\u2847\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28a8\n\u2877\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28b6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u28f6\u287e\n\u2800\u2800\u2800\u2809\u2809\u2809\u2809\u28fd\u287f\u2801\u28e0\u28fe\u287f\u283e\u28ef\u28ff\u283f\u282f\u28ad\u28c9\u2809\u2809\u2809\u2809\u28c9\u28ed\u28ff\u286f\u283d\u282f\u28ad\u28df\u286b\u28fd\u28ff\u28c1\u28e0\u28e6\u28c4\u2809\u2833\u28ff\u28cd\u2809\u2809\u2809\u2809\u2809\u2801\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u2803\u28a0\u28ff\u28ff\u28f4\u28fe\u283f\u281b\u280b\u2809\u281b\u2832\u282f\u28f5\u28f6\u286f\u281f\u280b\u2881\u28c0\u28e0\u28e4\u28e4\u28ec\u28fd\u28fe\u28ff\u28ff\u28fb\u28ff\u28ff\u28f7\u28c4\u2818\u28ff\u2844\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u2800\u28b8\u28ff\u287f\u281b\u2881\u28e4\u2836\u281b\u280b\u2809\u2809\u281b\u283b\u28bf\u2824\u2874\u281e\u281b\u28c9\u28fd\u283f\u281b\u2889\u28e0\u28e4\u28e4\u28a4\u28dd\u28ff\u28ff\u28ff\u28ff\u2844\u28b8\u28ff\u2840\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u2847\u2800\u28b8\u284f\u2800\u2830\u280b\u2801\u2800\u2800\u2880\u28e4\u28f6\u28fe\u28ff\u28ff\u2864\u2824\u2824\u28fe\u28cb\u2880\u2864\u281e\u28ab\u28ff\u28ff\u28ff\u28f7\u2844\u2809\u283b\u28ff\u28ff\u2847\u2800\u28ff\u2801\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u2847\u2800\u28b8\u28c7\u2800\u2800\u2800\u2880\u28e0\u283e\u288b\u2875\u288b\u28ff\u28bb\u28ff\u283f\u28f6\u2844\u2800\u28b9\u280b\u2800\u2800\u28ff\u28ff\u28bf\u28e7\u28ff\u28ff\u28c0\u28e0\u28ff\u28ff\u2801\u2800\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u2847\u2800\u28b8\u28ff\u2800\u2800\u281a\u281b\u28f7\u285e\u280b\u2800\u28b8\u28ff\u28df\u28bf\u28f6\u28ff\u28e7\u28e0\u287f\u28e4\u28e4\u28e4\u28fd\u287f\u283f\u281b\u281b\u2889\u28ff\u28ff\u28ff\u287f\u2800\u2800\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u2847\u2800\u2808\u28ff\u2800\u2800\u2800\u28c0\u28c0\u28c9\u28fb\u28f6\u28e4\u28ff\u28ff\u283f\u281f\u281b\u2809\u2801\u2800\u2800\u2800\u2800\u28c0\u28c0\u28e0\u28e4\u283e\u280b\u2889\u28ff\u28ff\u2847\u2800\u2800\u28ff\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u2847\u2800\u2800\u28ff\u2846\u28a0\u28fe\u280b\u2809\u28e9\u28c9\u28c9\u28d9\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u289b\u28c9\u28c9\u28e1\u28e4\u2876\u283e\u28ff\u28ff\u28ff\u2801\u2800\u28a0\u28ff\u2844\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28c7\u2800\u2800\u28bb\u2847\u2808\u281b\u2836\u28e6\u28ec\u28c9\u28c9\u28d9\u285b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u289b\u28db\u28c9\u28c9\u28c9\u28e0\u28e4\u28f6\u28ff\u281f\u2801\u2800\u2880\u28fe\u287f\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u28b8\u28ff\u2800\u2800\u2818\u28ff\u28e4\u2840\u2800\u2800\u2808\u2809\u2809\u2809\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u280b\u2809\u2809\u2809\u2881\u28e0\u28fc\u28cf\u2800\u28c0\u28f4\u287f\u280b\u2800\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u2808\u28ff\u28e7\u2800\u2800\u2818\u28bf\u28ff\u28b7\u28e6\u28c4\u28c0\u2800\u2800\u2800\u2800\u2800\u28c0\u28c0\u28c0\u28c0\u28c0\u28c0\u28c0\u28e0\u28e4\u28f6\u283f\u281b\u2809\u28a8\u28ff\u28ff\u281f\u280b\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2818\u28ff\u28e7\u2840\u2800\u2800\u28ff\u2800\u2808\u2809\u281b\u281b\u283f\u283f\u283f\u283f\u281b\u281b\u281b\u281b\u281b\u281b\u281b\u280b\u2809\u2800\u2800\u2800\u2800\u2808\u281b\u28be\u28e2\u2840\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\n\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28fe\u287f\u28bf\u28e6\u28f4\u287f\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2880\u2840\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u28bf\u28ff\u2804\u2800\u2800\u2800\u2800\u2800\u2800\u2800\u2800");
        }

        var res = await evilService.GetMetaDataAsync(pageIndex, pageSize);
        return Ok(res);
    }
}